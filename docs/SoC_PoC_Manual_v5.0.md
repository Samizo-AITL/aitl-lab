# 第0章 PoC設計全体像・AITL対応マニュアル概要

## 0.1 本マニュアルの目的
本マニュアルは、AITL（All-in-Theory Logic）構想に基づくSoC制御系PoC設計の全体像を示し、エンジニアが実務に活用できる体系的な設計指針と実践ノウハウを提供します。

## 0.2 PoC設計全体像とAITL対応
- AITL構想の概要とPoC設計への適用意義
- SoC制御系におけるPoC設計の位置づけ
- ハードウェア（RTL）とソフトウェア（SW）連携の重要性
- 評価・検証・管理の体系的アプローチ

## 0.3 マニュアルの章構成（v5.0版）
本マニュアルは以下の構成により、基礎から応用、実装・検証、出口戦略までを包括的にカバーします。

| 章番号   | 章タイトル                                 | 概要説明                                         |
| -------- | ----------------------------------------- | ------------------------------------------------ |
| 【0】緒言・導入 | 第0章：PoC設計全体像・AITL対応マニュアル概要 | 本マニュアルの目的と全体像紹介                     |
| 【I】基本技術基盤 | 第1章：PoC仕様策定と要件定義（AITL視点）          | AITL視点によるPoC仕様と要件の策定                 |
|          | 第2章：制御系設計の実務ポイント                 | PID制御、PWM、適応制御、現代制御理論の実践知識   |
|          | 第3章：RTL設計のAITL対応実務ポイント             | RTL設計におけるAITL理論適用の実務ポイント         |
|          | 第4章：PDKとファウンドリ選定（AITLと物理整合）     | PDK選定とファウンドリ検討、AITL設計との整合性     |
|          | 第5章：ソフト制御との連携設計（RISC-V上でのAITL連携）| RISC-Vを用いたソフト制御とAITL連携設計            |
| 【II】応用技術展開 | 第6章：センサ混載技術とアナログIF設計（AITL構造反映） | センサ混載・アナログインターフェース設計          |
|          | 第7章：DFT設計とテスト容易化（AITL評価指標含む）     | DFT設計とAITL評価指標を踏まえたテスト容易化        |
|          | 第8章：AI自己修復PoC設計手法（AITL理論適用）        | AIを活用した自己修復設計手法                       |
|          | 第9章：SoC統合と協調設計（ハード＋ソフト＋AITL連携） | ハード・ソフト統合設計とAITLによる協調設計         |
|          | 第10章：PoCプロジェクトの管理と評価（AITL評価体系）  | プロジェクト管理とAITL評価体系、ドキュメント管理    |
|          | 第11章：出口戦略とSystemDK移行設計                 | PoCからSystemDKへの移行設計手法                    |
| 【III】実装・検証 | 第12章：PoC評価の指標とプロジェクト管理（AITL観点）    | PoC評価指標の詳細とプロジェクト管理                |
| 【IV】出口とSystemDK | 第13章：製品化に向けた物理・実装検証                 | SI/PI、熱、応力、EMI/EMCなど物理検証               |
|          | 第14章：外付け・混載デバイスとのインタフェース設計     | 外付け・混載デバイスのインターフェース設計         |
|          | 第15章：SystemDK移行設計とIP再構成戦略（AITL設計資産化）| SystemDKへの設計資産化とIP再構成                    |
|          | 第16章：出口戦略別SystemDK開発方針                   | 出口戦略に応じたSystemDK開発の方針                 |
| 【付録】   | 付録A：設計テンプレート・PoC成果記録フォーマット       | 設計テンプレートや成果記録のフォーマット            |
|          | 付録B：出口戦略別チェックリスト                      | 出口戦略ごとのチェックリスト                         |
|          | 付録C：PoCDK→SystemDK変換事例集                      | PoCDKからSystemDKへ変換した事例集                    |

## 0.4 本マニュアルの利用方法
- 各章は相互に関連しながらも独立した内容として読み進めることが可能です。
- 実際の設計・検証コードは `src/rtl`（ハードウェア）、`src/sw`（ソフトウェア）に分けて管理しています。
- 評価・検証手法は `eval/` に収録し、テンプレートや設計雛形は `templates/` に用意しています。
- 本マニュアルは継続的に更新し、最新のAITL理論・実務に対応させていきます。

---

# 第1章 PoC仕様策定と要件定義（AITL視点）

## 1.1 本章の目的
本章では、SoC制御系PoCにおける仕様策定と要件定義の手順を示し、AITL構想に沿った形での設計出発点を明確化します。PoCの対象スコープ、設計制約、AITL適用範囲を整理することが目的です。

## 1.2 AITL構想に基づく設計出発点
- AITLとは「All-in-Theory Logic」の略であり、設計理論・評価基準・制御哲学を内包する概念。
- AITLは仕様策定段階から「目的関数ベースの制約モデル化」や「最適化指向設計」を重視する。
- 本PoCでは、AITLの観点を用いて以下を定義：
  - 制御対象（plant）のモデル化レベル（抽象/物理/論理）
  - 制御目標の階層（基本制御／協調制御／自己修復）
  - 評価メトリクス（応答性、安定性、効率性）

## 1.3 仕様策定プロセス（AITL対応）
### 1.3.1 設計対象スコープの明確化
- 対象とする制御系の種類：例）DCモーター制御、電源制御、温調制御など
- 制御対象の抽象モデル：状態遷移、入出力、制御則の定義

### 1.3.2 AITLによる要求階層の定義
| 層 | 要求内容の例 | 解説 |
|----|---------------|------|
| L0 | 物理制約     | 電圧・温度・電流などの制限条件 |
| L1 | 機能要件     | 制御性能、動作モード、異常処理 |
| L2 | 構造要件     | モジュール構成、再利用性、分割設計可能性 |
| L3 | 認識／推論要件 | 自己診断、フィードバック適応、信号分類など |

### 1.3.3 AITL PoC仕様記述テンプレート（概要）
```text
[PoC機能名]：例）電流制御モジュール  
[目的関数]：例）目標電流への最小時間応答  
[設計制約]：例）PWM周波数、応答遅れ、発熱限界  
[評価指標]：例）オーバーシュート、定常誤差、制御周期  
[AITL連携]：構造設計との接点、自己修復機構の挿入位置
```

## 1.4 PoC設計における要件定義のチェックポイント

- **環境依存条件の明確化**  
  使用温度範囲、電源電圧、発振器の安定性、外部クロック源の条件など、PoCの運用に影響を及ぼす環境条件を明示する必要があります。

- **非機能要件の明示**  
  機能だけでなく、以下のような非機能的要件も事前に定義することがPoC品質に直結します。  
  例：消費電力上限、物理実装面積、テスト容易性（DFT対応）、FPGAでの一時実装可否など。

- **スケーラビリティと再利用性**  
  設計モジュールが将来的にSystemDKへ移行できるよう、ブロック分割やインタフェース仕様を意識した構造化を初期段階から設計に盛り込みます。


## 1.5 本章まとめ

- **仕様策定はPoC設計の最初かつ最重要フェーズ**であり、AITLの観点から「階層的」「目的関数的」に構造化して進めることが成功の鍵となります。
- **AITLを活用することで、従来の「仕様書記述」から「意味構造ベース設計」へと発展可能**であり、上流段階からPoC設計に知的構造を埋め込むことができます。
- **以降の章では、本章で定義した仕様と要件を基に、ハード・ソフト・評価連携を含む実装プロセスへと展開**していきます。

---

# 第2章 制御系設計の実務ポイント  
（PID、PWM、適応制御、現代制御理論）

## 2.1 本章の目的
本章では、SoCにおける制御系設計を行う上での基本的かつ実践的な知識をまとめます。  
AITL視点からは「目的関数に基づく構造的制御設計」として、制御理論とハードウェア実装を橋渡しします。

## 2.2 制御系設計の基本構造とSoC実装の観点
- 制御ループの構成：センサ入力 → 制御計算 → アクチュエータ出力
- SoC制御系における構成例：ADC → PID計算（SW/RTL）→ PWM出力
- 信号帯域・遅延・分解能・量子化誤差などの影響
- AITL観点：制御モデルの階層性とパラメトリック設計の重要性

## 2.3 PID制御の実装ノウハウ
### 2.3.1 離散時間PID制御の基本式
```math
u[k] = Kp·e[k] + Ki·∑e[k]Δt + Kd·(e[k] - e[k-1])/Δt
```

### 2.3.2 実装上のポイント

- **ADCサンプリング周期と制御周期の一致**  
  制御ループの正確な応答性確保のためには、ADCのサンプリング周期とPID計算周期を一致させる必要があります。

- **積分飽和対策（アンチワインドアップ）**  
  積分動作が飽和して暴走するのを防ぐため、出力制限と積分リセットを導入します。

- **微分ノイズ対策（低通フィルタ付加）**  
  微分項はノイズに敏感なため、LPF（Low Pass Filter）を付加してノイズの影響を低減します。

- **RTL実装と固定小数点の活用例**  
  RTLによるPID制御では、浮動小数点演算の代わりに固定小数点を使用することで、面積と性能のバランスをとります。


### 2.3.3 RTL or ソフト設計の分担

| 機能             | 実装対象     | 理由                             |
|------------------|--------------|----------------------------------|
| PID計算          | SWまたはRTL  | 処理負荷と応答速度のバランスを考慮 |
| 積分状態保持     | レジスタ/RAM | 状態管理のため                   |
| ゲイン調整       | SW可変設計   | 現場でのチューニング対応の柔軟性 |


## 2.4 PWM制御とデューティ変調

- **PWMの周期、分解能、リップルとの関係**  
  周期が長くなると分解能が上がるが応答遅れが増える。短すぎるとリップルやノイズが増加。

- **位相ずれ・ノイズ抑制設計**  
  複数PWM出力を持つ場合、位相制御でノイズを分散させる設計が重要。

- **カウンタベースPWM回路設計**  
  VerilogによるPWMモジュールは `src/rtl/` に別途記述予定。例：up-downカウンタ型、センターアライナ型など。

- **RISC-VからのPWMパラメータ制御例**  
  レジスタマッピングを通じてPWM周期・デューティ比を制御。制御コードは `src/sw/` に配置。


## 2.5 適応制御の導入（モデルベース設計とオンライン更新）

- **モデルの時間変動に対する制御法**  
  外乱や経年変化に応じて制御パラメータをリアルタイムで調整可能な設計。

- **ゲインスケジューリングとパラメータ推定法**  
  動作点に応じて最適なパラメータを事前定義、または推定（オンライン/オフライン）。

- **AI/MLとの連携による「適応則の構造化」**  
  AITL構造において「認識ブロック」との連携を想定し、学習モデルを適応制御則に統合する道筋を整備。


## 2.6 現代制御理論とPoC適用の勘所

- **状態空間モデルと可制御性・可観測性**  
  現代制御理論では、可制御性と可観測性がPoCの設計・テスト可能性を左右する。

- **LQR（最適レギュレータ）、H∞制御の実用領域**  
  安定性と応答性を両立させる理論的な制御設計手法。制御対象に応じた選択が必要。

- **ハードウェア実装の際の行列表現の注意点**  
  数値安定性を意識し、演算順序やスケーリング処理に工夫が必要。

- **AITL評価指標としての安定余裕・制御効果指標の構築**  
  制御系の性能をAITL構造に反映し、形式的評価に展開できる指標群を構築。


## 2.7 本章まとめ

- **制御設計はPoCにおける機能中心軸**であり、ハードウェアとソフトウェアの適切な分担が求められる。
- **AITLの考え方を導入することで、「構造的」「目的関数駆動型」の制御設計へ発展**させることが可能。
- **次章では、制御構造をRTLに実装するための実務的設計ポイント**を詳述する。

---

# 第3章 RTL設計のAITL対応実務ポイント

## 3.1 本章の目的
本章では、SoC制御系PoCにおけるRTL（Register Transfer Level）設計の実務ポイントを整理します。  
特に、AITL構想における「論理構造」「意味的接続」「評価指標との整合性」を意識したRTL設計の進め方を解説します。


## 3.2 AITLにおける論理設計の位置づけ
- **AITLの三層構造との対応**：制御論理層（L1）と構造論理層（L2）にRTLが対応
- **目的関数に基づくモジュール設計**：各RTLブロックに機能目的を明記
- **評価指標とのトレーサビリティ**：PoC評価項目（例：応答速度、再利用性）との関連性を設計に埋め込む


## 3.3 RTL設計の基本方針とブロック化
### 3.3.1 設計要素の分解と構造化
- 入力／出力／状態／制御信号の明示
- パイプライン、FSM（状態機械）、FIFOなどの基本構造
- ブロック設計単位の原則：「単機能・明確目的・再利用志向」

### 3.3.2 モジュール分割例（制御系PoC）
| 機能カテゴリ     | モジュール例             | 備考                        |
|------------------|--------------------------|-----------------------------|
| センサIF         | adc_if.v                | ADCデータの取得と同期       |
| 制御演算         | pid_core.v              | PID制御演算                 |
| 出力制御         | pwm_gen.v               | PWM出力制御                 |
| 状態管理         | control_fsm.v           | モード切替、エラー処理制御  |


## 3.4 設計言語・コーディングスタイル
- **Verilog/SystemVerilogの使用方針**：PoC段階はVerilogで十分、SystemDK段階で拡張
- **可読性・保守性の高いスタイル**：命名規則、一貫したインデント、信号の前方宣言など
- **非同期設計の抑制**：PoCでは全同期設計を基本とし、非同期部分は明示管理する


## 3.5 AITL対応のための設計技術
### 3.5.1 意味接続を意識したモジュール設計
- 単なる機能分割ではなく、「目的関数→制御構造→論理モジュール」の流れを保つ
- AITL記述テンプレートへの接続（付録A参照予定）

### 3.5.2 再構成可能性と構造設計
- 論理ブロックのスケーラビリティ設計（例：パラメータ化）
- AITL構造木（semantic block tree）への展開容易性を意識


## 3.6 PoCでのRTL検証と将来展開
- **FPGA上での初期検証**：RTL設計直後に評価できる環境を整備（eval/ へ反映）
- **SystemDKへの移行**：IP単位での構造保存とAITL資産への変換を視野に


## 3.7 本章まとめ
- RTL設計はPoCにおける**論理的中核**であり、AITL構造の中で最も実装密度が高い層を担う。
- AITL的視点では「構造目的の明示」「意味接続の保存」「再構成性の担保」が設計原則となる。
- 次章では、**物理設計との整合（PDK選定）**について扱い、AITLと製造制約の接続を試みる。

---

# 第4章 PDKとファウンドリ選定（AITLと物理整合）

## 4.1 本章の目的
本章では、PoCの物理実装における前提となるPDK（Process Design Kit）の選定と、ファウンドリ選定の要点を解説します。  
また、AITL構想と物理設計の整合を意識した「論理⇔物理接続設計」の実践方針を明示します。


## 4.2 PDKとは何か：設計と製造を結ぶインタフェース
- PDKは「製造プロセスに特化した設計情報のパッケージ」
- 含まれる内容：DRC/LVSルール、ライブラリ、SPICEモデル、IOセル、ESD構造、など
- AITL視点での注目点：
  - 機能設計との整合（電源分離、IO配置自由度）
  - 評価可能性（物理特性モデルの抽象度）


## 4.3 ファウンドリ選定の実務観点
### 4.3.1 主要ファウンドリ例（PoC用途）
| ファウンドリ      | 特徴                                 |
|------------------|--------------------------------------|
| TSMC             | 最先端/汎用プロセス豊富、PDK成熟     |
| UMC              | コスト効率良、車載用途あり            |
| GF (GlobalFoundries) | FD-SOI系に強み、低消費電力向け      |
| Tower-Semiconductor | アナログ混載・パワーデバイス対応     |
| SkyWater (Open)  | オープンPDK提供（130nm, 180nm）     |

### 4.3.2 評価指標
- 物理整合度：PoC仕様との一致性（電源条件、パッケージ制約）
- サポート体制：PoC開発段階でのPDKサポート・回答時間
- テープアウト容易性：FPGAからASIC移行までの道筋


## 4.4 AITLとの整合性ポイント
### 4.4.1 AITLにおける物理パラメータ階層
- AITL階層における物理接続：L0層（物理制約）とのリンク
- 抽象設計（論理モデル）からのマッピング構造：
```text
[AITLモデルの目的関数]
↓
[構造論理設計（RTL）]
↓
[PDK制約内での配置・配線]
```
### 4.4.2 論理設計とPDK制約の橋渡し
- クロックツリー制約、供給電圧域、セル使用禁止条件などを事前に把握
- 電源／GND／ESD構造の設計制約をRTL設計前に整理
- 多電源対応設計（Multi-VDD）への布石


## 4.5 PoC実装時のPDK利用パターン
- **ソフトマクロ（Soft Macro）設計**：RTL段階でPDK整合性を意識した論理IP設計
- **FPGA評価→ASIC移行**：SkyWaterやGFのPDKを想定した変換設計
- **SystemDK移行時の整合性**：PDK仕様をAITL設計資産へ反映


## 4.6 本章まとめ
- PDKとファウンドリはPoC設計と実装の「物理的な土台」であり、早期の選定がPoCの品質とスピードを左右する。
- AITL設計では、L0層（物理制約）と論理階層の整合が求められる。
- 次章では、ソフトウェア制御とハードロジックとの連携に着目し、RISC-VをベースとしたPoC構造を扱う。

---

# 第5章 ソフト制御との連携設計（RISC-V上でのAITL連携）

## 5.1 本章の目的
本章では、SoC制御系PoCにおいて、ハードウェア（RTL）とソフトウェア（制御コード）がどのように連携し、AITL構造の中で協調動作するかを解説します。  
主にRISC-Vベースのソフト制御設計を対象に、AITL構想との接続構造を構築します。


## 5.2 ソフト制御の役割とAITL位置づけ
- ソフト制御は「状態判断・制御則選択・チューニング」に集中
- AITL構造では、**L1層（機能層）とL2層（構造層）を横断する制御機構**
- ハードロジックで固定された制御ループの「可変部・知的部」をソフトが補完


## 5.3 RISC-Vベース構成とPoCアーキテクチャ
### 5.3.1 PoC構成例
```text
[センサ入力] → [ADC] → [RTL（PID/FSM）]
↑       ↓
[RISC-V SoC ← Software制御層]
```

- SoCには最小構成のRISC-Vコアを使用（例：RV32I）
- 制御対象：PWM設定、パラメータチューニング、動作モード制御など
- メモリマップ構成：レジスタベースでRTLとバス接続（APB/AXI-Lite）

### 5.3.2 RISC-Vソフト制御の役割
| 機能               | 対応内容                             |
|--------------------|--------------------------------------|
| PIDゲイン調整      | Kp, Ki, Kd をソフトウェアから設定     |
| 状態切替制御        | モード遷移、エラー回避処理             |
| センサ読取り評価    | ADC値の処理・分類                     |
| ログ出力／通信     | UART/I2C経由で外部にログ・状態を送信 |

---

## 5.4 ソフト／ハード連携インタフェース設計
### 5.4.1 メモリマップ設計の基本
- 各RTLモジュールに制御レジスタブロックを割当
- 読出専用（RO）、書込専用（WO）、読書可（RW）を明示
- 例：
```text
0x0000_0000: PWM制御レジスタ（デューティ比）
0x0000_0004: PID_Kp
0x0000_0008: PID_Ki
0x0000_000C: PID_Kd
0x0000_0010: ADC読み取り値（RO）
```

### 5.4.2 割込み・DMAなどのイベント処理構造

- **割込みによるADC読取のトリガー制御**  
  一定周期または外部イベントに応じて、ADCのサンプリングをソフトウェアからトリガー。応答性の高い設計が可能。

- **DMA経由でのセンサデータバッファ化**  
  高頻度なセンサ読み取りでは、CPU介入を最小化するためにDMAを使用してデータをメモリに自動転送する。

- **低遅延処理と応答速度向上のための設計オプション**  
  割込み優先度設定、ダブルバッファリング、イベントドリブン方式の導入により、リアルタイム性を高める。


## 5.5 AITL構造との統合観点

- **RISC-VソフトはAITLにおける「意味制御ノード（Semantic Control Node）」を担う**  
  AITL全体の制御構造における可変性と知的判断機能を担う中核。

- **状態遷移・推論制御・自己適応などの上位機構のプロトタイプをソフト制御で実装**  
  FSMベースの状態制御や、パラメトリックな推論モデルの運用を通じて、PoCに知的挙動を付与。

- **将来的なAI自己修復系（第8章）への接続基盤**  
  ソフト制御層は、AIによる自己診断・自己最適化機構と直接接続される領域。ここでの設計方針が、PoC→AI PoCへの進化を決定づける。


## 5.6 PoCソフト制御コードの管理方針

- **ソース構成**  
  `src/sw/` 以下に機能別ディレクトリを設け、目的別にソースを整理。  
  例：
```text
  src/sw/
├── pid_ctrl/
├── pwm_test/
└── sensor_adc/
```

- **ビルド環境**  
RISC-V向けGCCツールチェーン、またはPlatformIO環境の導入を推奨。

- **ドキュメント管理**  
各ソフト制御モジュールと対応レジスタの一覧を `docs/appendix/` 以下に整理し、PoCの再構成性を支援する。

## 5.7 本章まとめ

- **RISC-Vベースのソフト制御設計は、AITL構造とハードウェア制御を橋渡しする知的接続ノード**である。
- **制御ロジックの固定部（RTL）と可変部（ソフト）を分離**することで、柔軟かつ評価可能なPoCが実現できる。
- **次章では、アナログ信号処理とセンサ統合について、AITL構造との整合設計を扱う**。

---
