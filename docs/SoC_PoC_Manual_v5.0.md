# 第0章 PoC設計全体像・AITL対応マニュアル概要

## 0.1 本マニュアルの目的
本マニュアルは、AITL（All-in-Theory Logic）構想に基づくSoC制御系PoC設計の全体像を示し、エンジニアが実務に活用できる体系的な設計指針と実践ノウハウを提供します。

## 0.2 PoC設計全体像とAITL対応
- AITL構想の概要とPoC設計への適用意義
- SoC制御系におけるPoC設計の位置づけ
- ハードウェア（RTL）とソフトウェア（SW）連携の重要性
- 評価・検証・管理の体系的アプローチ

## 0.3 マニュアルの章構成（v5.0版）
本マニュアルは以下の構成により、基礎から応用、実装・検証、出口戦略までを包括的にカバーします。

| 章番号   | 章タイトル                                 | 概要説明                                         |
| -------- | ----------------------------------------- | ------------------------------------------------ |
| 【0】緒言・導入 | 第0章：PoC設計全体像・AITL対応マニュアル概要 | 本マニュアルの目的と全体像紹介                     |
| 【I】基本技術基盤 | 第1章：PoC仕様策定と要件定義（AITL視点）          | AITL視点によるPoC仕様と要件の策定                 |
|          | 第2章：制御系設計の実務ポイント                 | PID制御、PWM、適応制御、現代制御理論の実践知識   |
|          | 第3章：RTL設計のAITL対応実務ポイント             | RTL設計におけるAITL理論適用の実務ポイント         |
|          | 第4章：PDKとファウンドリ選定（AITLと物理整合）     | PDK選定とファウンドリ検討、AITL設計との整合性     |
|          | 第5章：ソフト制御との連携設計（RISC-V上でのAITL連携）| RISC-Vを用いたソフト制御とAITL連携設計            |
| 【II】応用技術展開 | 第6章：センサ混載技術とアナログIF設計（AITL構造反映） | センサ混載・アナログインターフェース設計          |
|          | 第7章：DFT設計とテスト容易化（AITL評価指標含む）     | DFT設計とAITL評価指標を踏まえたテスト容易化        |
|          | 第8章：AI自己修復PoC設計手法（AITL理論適用）        | AIを活用した自己修復設計手法                       |
|          | 第9章：SoC統合と協調設計（ハード＋ソフト＋AITL連携） | ハード・ソフト統合設計とAITLによる協調設計         |
|          | 第10章：PoCプロジェクトの管理と評価（AITL評価体系）  | プロジェクト管理とAITL評価体系、ドキュメント管理    |
|          | 第11章：出口戦略とSystemDK移行設計                 | PoCからSystemDKへの移行設計手法                    |
| 【III】実装・検証 | 第12章：PoC評価の指標とプロジェクト管理（AITL観点）    | PoC評価指標の詳細とプロジェクト管理                |
| 【IV】出口とSystemDK | 第13章：製品化に向けた物理・実装検証                 | SI/PI、熱、応力、EMI/EMCなど物理検証               |
|          | 第14章：外付け・混載デバイスとのインタフェース設計     | 外付け・混載デバイスのインターフェース設計         |
|          | 第15章：SystemDK移行設計とIP再構成戦略（AITL設計資産化）| SystemDKへの設計資産化とIP再構成                    |
|          | 第16章：出口戦略別SystemDK開発方針                   | 出口戦略に応じたSystemDK開発の方針                 |
| 【付録】   | 付録A：設計テンプレート・PoC成果記録フォーマット       | 設計テンプレートや成果記録のフォーマット            |
|          | 付録B：出口戦略別チェックリスト                      | 出口戦略ごとのチェックリスト                         |
|          | 付録C：PoCDK→SystemDK変換事例集                      | PoCDKからSystemDKへ変換した事例集                    |

## 0.4 本マニュアルの利用方法
- 各章は相互に関連しながらも独立した内容として読み進めることが可能です。
- 実際の設計・検証コードは `src/rtl`（ハードウェア）、`src/sw`（ソフトウェア）に分けて管理しています。
- 評価・検証手法は `eval/` に収録し、テンプレートや設計雛形は `templates/` に用意しています。
- 本マニュアルは継続的に更新し、最新のAITL理論・実務に対応させていきます。

---

# 第1章 PoC仕様策定と要件定義（AITL視点）

## 1.1 本章の目的
本章では、SoC制御系PoCにおける仕様策定と要件定義の手順を示し、AITL構想に沿った形での設計出発点を明確化します。PoCの対象スコープ、設計制約、AITL適用範囲を整理することが目的です。

## 1.2 AITL構想に基づく設計出発点
- AITLとは「All-in-Theory Logic」の略であり、設計理論・評価基準・制御哲学を内包する概念。
- AITLは仕様策定段階から「目的関数ベースの制約モデル化」や「最適化指向設計」を重視する。
- 本PoCでは、AITLの観点を用いて以下を定義：
  - 制御対象（plant）のモデル化レベル（抽象/物理/論理）
  - 制御目標の階層（基本制御／協調制御／自己修復）
  - 評価メトリクス（応答性、安定性、効率性）

## 1.3 仕様策定プロセス（AITL対応）
### 1.3.1 設計対象スコープの明確化
- 対象とする制御系の種類：例）DCモーター制御、電源制御、温調制御など
- 制御対象の抽象モデル：状態遷移、入出力、制御則の定義

### 1.3.2 AITLによる要求階層の定義
| 層 | 要求内容の例 | 解説 |
|----|---------------|------|
| L0 | 物理制約     | 電圧・温度・電流などの制限条件 |
| L1 | 機能要件     | 制御性能、動作モード、異常処理 |
| L2 | 構造要件     | モジュール構成、再利用性、分割設計可能性 |
| L3 | 認識／推論要件 | 自己診断、フィードバック適応、信号分類など |

### 1.3.3 AITL PoC仕様記述テンプレート（概要）
```text
[PoC機能名]：例）電流制御モジュール  
[目的関数]：例）目標電流への最小時間応答  
[設計制約]：例）PWM周波数、応答遅れ、発熱限界  
[評価指標]：例）オーバーシュート、定常誤差、制御周期  
[AITL連携]：構造設計との接点、自己修復機構の挿入位置
```

## 1.4 PoC設計における要件定義のチェックポイント

- **環境依存条件の明確化**  
  使用温度範囲、電源電圧、発振器の安定性、外部クロック源の条件など、PoCの運用に影響を及ぼす環境条件を明示する必要があります。

- **非機能要件の明示**  
  機能だけでなく、以下のような非機能的要件も事前に定義することがPoC品質に直結します。  
  例：消費電力上限、物理実装面積、テスト容易性（DFT対応）、FPGAでの一時実装可否など。

- **スケーラビリティと再利用性**  
  設計モジュールが将来的にSystemDKへ移行できるよう、ブロック分割やインタフェース仕様を意識した構造化を初期段階から設計に盛り込みます。


## 1.5 本章まとめ

- **仕様策定はPoC設計の最初かつ最重要フェーズ**であり、AITLの観点から「階層的」「目的関数的」に構造化して進めることが成功の鍵となります。
- **AITLを活用することで、従来の「仕様書記述」から「意味構造ベース設計」へと発展可能**であり、上流段階からPoC設計に知的構造を埋め込むことができます。
- **以降の章では、本章で定義した仕様と要件を基に、ハード・ソフト・評価連携を含む実装プロセスへと展開**していきます。

---

# 第2章 制御系設計の実務ポイント  
（PID、PWM、適応制御、現代制御理論）

## 2.1 本章の目的
本章では、SoCにおける制御系設計を行う上での基本的かつ実践的な知識をまとめます。  
AITL視点からは「目的関数に基づく構造的制御設計」として、制御理論とハードウェア実装を橋渡しします。

## 2.2 制御系設計の基本構造とSoC実装の観点
- 制御ループの構成：センサ入力 → 制御計算 → アクチュエータ出力
- SoC制御系における構成例：ADC → PID計算（SW/RTL）→ PWM出力
- 信号帯域・遅延・分解能・量子化誤差などの影響
- AITL観点：制御モデルの階層性とパラメトリック設計の重要性

## 2.3 PID制御の実装ノウハウ
### 2.3.1 離散時間PID制御の基本式
```math
u[k] = Kp·e[k] + Ki·∑e[k]Δt + Kd·(e[k] - e[k-1])/Δt
```

### 2.3.2 実装上のポイント

- **ADCサンプリング周期と制御周期の一致**  
  制御ループの正確な応答性確保のためには、ADCのサンプリング周期とPID計算周期を一致させる必要があります。

- **積分飽和対策（アンチワインドアップ）**  
  積分動作が飽和して暴走するのを防ぐため、出力制限と積分リセットを導入します。

- **微分ノイズ対策（低通フィルタ付加）**  
  微分項はノイズに敏感なため、LPF（Low Pass Filter）を付加してノイズの影響を低減します。

- **RTL実装と固定小数点の活用例**  
  RTLによるPID制御では、浮動小数点演算の代わりに固定小数点を使用することで、面積と性能のバランスをとります。


### 2.3.3 RTL or ソフト設計の分担

| 機能             | 実装対象     | 理由                             |
|------------------|--------------|----------------------------------|
| PID計算          | SWまたはRTL  | 処理負荷と応答速度のバランスを考慮 |
| 積分状態保持     | レジスタ/RAM | 状態管理のため                   |
| ゲイン調整       | SW可変設計   | 現場でのチューニング対応の柔軟性 |


## 2.4 PWM制御とデューティ変調

- **PWMの周期、分解能、リップルとの関係**  
  周期が長くなると分解能が上がるが応答遅れが増える。短すぎるとリップルやノイズが増加。

- **位相ずれ・ノイズ抑制設計**  
  複数PWM出力を持つ場合、位相制御でノイズを分散させる設計が重要。

- **カウンタベースPWM回路設計**  
  VerilogによるPWMモジュールは `src/rtl/` に別途記述予定。例：up-downカウンタ型、センターアライナ型など。

- **RISC-VからのPWMパラメータ制御例**  
  レジスタマッピングを通じてPWM周期・デューティ比を制御。制御コードは `src/sw/` に配置。


## 2.5 適応制御の導入（モデルベース設計とオンライン更新）

- **モデルの時間変動に対する制御法**  
  外乱や経年変化に応じて制御パラメータをリアルタイムで調整可能な設計。

- **ゲインスケジューリングとパラメータ推定法**  
  動作点に応じて最適なパラメータを事前定義、または推定（オンライン/オフライン）。

- **AI/MLとの連携による「適応則の構造化」**  
  AITL構造において「認識ブロック」との連携を想定し、学習モデルを適応制御則に統合する道筋を整備。


## 2.6 現代制御理論とPoC適用の勘所

- **状態空間モデルと可制御性・可観測性**  
  現代制御理論では、可制御性と可観測性がPoCの設計・テスト可能性を左右する。

- **LQR（最適レギュレータ）、H∞制御の実用領域**  
  安定性と応答性を両立させる理論的な制御設計手法。制御対象に応じた選択が必要。

- **ハードウェア実装の際の行列表現の注意点**  
  数値安定性を意識し、演算順序やスケーリング処理に工夫が必要。

- **AITL評価指標としての安定余裕・制御効果指標の構築**  
  制御系の性能をAITL構造に反映し、形式的評価に展開できる指標群を構築。


## 2.7 本章まとめ

- **制御設計はPoCにおける機能中心軸**であり、ハードウェアとソフトウェアの適切な分担が求められる。
- **AITLの考え方を導入することで、「構造的」「目的関数駆動型」の制御設計へ発展**させることが可能。
- **次章では、制御構造をRTLに実装するための実務的設計ポイント**を詳述する。

---

# 第3章 RTL設計のAITL対応実務ポイント

## 3.1 本章の目的
本章では、SoC制御系PoCにおけるRTL（Register Transfer Level）設計の実務ポイントを整理します。  
特に、AITL構想における「論理構造」「意味的接続」「評価指標との整合性」を意識したRTL設計の進め方を解説します。


## 3.2 AITLにおける論理設計の位置づけ
- **AITLの三層構造との対応**：制御論理層（L1）と構造論理層（L2）にRTLが対応
- **目的関数に基づくモジュール設計**：各RTLブロックに機能目的を明記
- **評価指標とのトレーサビリティ**：PoC評価項目（例：応答速度、再利用性）との関連性を設計に埋め込む


## 3.3 RTL設計の基本方針とブロック化
### 3.3.1 設計要素の分解と構造化
- 入力／出力／状態／制御信号の明示
- パイプライン、FSM（状態機械）、FIFOなどの基本構造
- ブロック設計単位の原則：「単機能・明確目的・再利用志向」

### 3.3.2 モジュール分割例（制御系PoC）
| 機能カテゴリ     | モジュール例             | 備考                        |
|------------------|--------------------------|-----------------------------|
| センサIF         | adc_if.v                | ADCデータの取得と同期       |
| 制御演算         | pid_core.v              | PID制御演算                 |
| 出力制御         | pwm_gen.v               | PWM出力制御                 |
| 状態管理         | control_fsm.v           | モード切替、エラー処理制御  |


## 3.4 設計言語・コーディングスタイル
- **Verilog/SystemVerilogの使用方針**：PoC段階はVerilogで十分、SystemDK段階で拡張
- **可読性・保守性の高いスタイル**：命名規則、一貫したインデント、信号の前方宣言など
- **非同期設計の抑制**：PoCでは全同期設計を基本とし、非同期部分は明示管理する


## 3.5 AITL対応のための設計技術
### 3.5.1 意味接続を意識したモジュール設計
- 単なる機能分割ではなく、「目的関数→制御構造→論理モジュール」の流れを保つ
- AITL記述テンプレートへの接続（付録A参照予定）

### 3.5.2 再構成可能性と構造設計
- 論理ブロックのスケーラビリティ設計（例：パラメータ化）
- AITL構造木（semantic block tree）への展開容易性を意識


## 3.6 PoCでのRTL検証と将来展開
- **FPGA上での初期検証**：RTL設計直後に評価できる環境を整備（eval/ へ反映）
- **SystemDKへの移行**：IP単位での構造保存とAITL資産への変換を視野に


## 3.7 本章まとめ
- RTL設計はPoCにおける**論理的中核**であり、AITL構造の中で最も実装密度が高い層を担う。
- AITL的視点では「構造目的の明示」「意味接続の保存」「再構成性の担保」が設計原則となる。
- 次章では、**物理設計との整合（PDK選定）**について扱い、AITLと製造制約の接続を試みる。

---

# 第4章 PDKとファウンドリ選定（AITLと物理整合）

## 4.1 本章の目的
本章では、PoCの物理実装における前提となるPDK（Process Design Kit）の選定と、ファウンドリ選定の要点を解説します。  
また、AITL構想と物理設計の整合を意識した「論理⇔物理接続設計」の実践方針を明示します。


## 4.2 PDKとは何か：設計と製造を結ぶインタフェース
- PDKは「製造プロセスに特化した設計情報のパッケージ」
- 含まれる内容：DRC/LVSルール、ライブラリ、SPICEモデル、IOセル、ESD構造、など
- AITL視点での注目点：
  - 機能設計との整合（電源分離、IO配置自由度）
  - 評価可能性（物理特性モデルの抽象度）


## 4.3 ファウンドリ選定の実務観点
### 4.3.1 主要ファウンドリ例（PoC用途）
| ファウンドリ      | 特徴                                 |
|------------------|--------------------------------------|
| TSMC             | 最先端/汎用プロセス豊富、PDK成熟     |
| UMC              | コスト効率良、車載用途あり            |
| GF (GlobalFoundries) | FD-SOI系に強み、低消費電力向け      |
| Tower-Semiconductor | アナログ混載・パワーデバイス対応     |
| SkyWater (Open)  | オープンPDK提供（130nm, 180nm）     |

### 4.3.2 評価指標
- 物理整合度：PoC仕様との一致性（電源条件、パッケージ制約）
- サポート体制：PoC開発段階でのPDKサポート・回答時間
- テープアウト容易性：FPGAからASIC移行までの道筋


## 4.4 AITLとの整合性ポイント
### 4.4.1 AITLにおける物理パラメータ階層
- AITL階層における物理接続：L0層（物理制約）とのリンク
- 抽象設計（論理モデル）からのマッピング構造：
```text
[AITLモデルの目的関数]
↓
[構造論理設計（RTL）]
↓
[PDK制約内での配置・配線]
```
### 4.4.2 論理設計とPDK制約の橋渡し
- クロックツリー制約、供給電圧域、セル使用禁止条件などを事前に把握
- 電源／GND／ESD構造の設計制約をRTL設計前に整理
- 多電源対応設計（Multi-VDD）への布石


## 4.5 PoC実装時のPDK利用パターン
- **ソフトマクロ（Soft Macro）設計**：RTL段階でPDK整合性を意識した論理IP設計
- **FPGA評価→ASIC移行**：SkyWaterやGFのPDKを想定した変換設計
- **SystemDK移行時の整合性**：PDK仕様をAITL設計資産へ反映


## 4.6 本章まとめ
- PDKとファウンドリはPoC設計と実装の「物理的な土台」であり、早期の選定がPoCの品質とスピードを左右する。
- AITL設計では、L0層（物理制約）と論理階層の整合が求められる。
- 次章では、ソフトウェア制御とハードロジックとの連携に着目し、RISC-VをベースとしたPoC構造を扱う。

---

# 第5章 ソフト制御との連携設計（RISC-V上でのAITL連携）

## 5.1 本章の目的
本章では、SoC制御系PoCにおいて、ハードウェア（RTL）とソフトウェア（制御コード）がどのように連携し、AITL構造の中で協調動作するかを解説します。  
主にRISC-Vベースのソフト制御設計を対象に、AITL構想との接続構造を構築します。


## 5.2 ソフト制御の役割とAITL位置づけ
- ソフト制御は「状態判断・制御則選択・チューニング」に集中
- AITL構造では、**L1層（機能層）とL2層（構造層）を横断する制御機構**
- ハードロジックで固定された制御ループの「可変部・知的部」をソフトが補完


## 5.3 RISC-Vベース構成とPoCアーキテクチャ
### 5.3.1 PoC構成例
```text
[センサ入力] → [ADC] → [RTL（PID/FSM）]
↑       ↓
[RISC-V SoC ← Software制御層]
```

- SoCには最小構成のRISC-Vコアを使用（例：RV32I）
- 制御対象：PWM設定、パラメータチューニング、動作モード制御など
- メモリマップ構成：レジスタベースでRTLとバス接続（APB/AXI-Lite）

### 5.3.2 RISC-Vソフト制御の役割
| 機能               | 対応内容                             |
|--------------------|--------------------------------------|
| PIDゲイン調整      | Kp, Ki, Kd をソフトウェアから設定     |
| 状態切替制御        | モード遷移、エラー回避処理             |
| センサ読取り評価    | ADC値の処理・分類                     |
| ログ出力／通信     | UART/I2C経由で外部にログ・状態を送信 |

---

## 5.4 ソフト／ハード連携インタフェース設計
### 5.4.1 メモリマップ設計の基本
- 各RTLモジュールに制御レジスタブロックを割当
- 読出専用（RO）、書込専用（WO）、読書可（RW）を明示
- 例：
```text
0x0000_0000: PWM制御レジスタ（デューティ比）
0x0000_0004: PID_Kp
0x0000_0008: PID_Ki
0x0000_000C: PID_Kd
0x0000_0010: ADC読み取り値（RO）
```

### 5.4.2 割込み・DMAなどのイベント処理構造

- **割込みによるADC読取のトリガー制御**  
  一定周期または外部イベントに応じて、ADCのサンプリングをソフトウェアからトリガー。応答性の高い設計が可能。

- **DMA経由でのセンサデータバッファ化**  
  高頻度なセンサ読み取りでは、CPU介入を最小化するためにDMAを使用してデータをメモリに自動転送する。

- **低遅延処理と応答速度向上のための設計オプション**  
  割込み優先度設定、ダブルバッファリング、イベントドリブン方式の導入により、リアルタイム性を高める。


## 5.5 AITL構造との統合観点

- **RISC-VソフトはAITLにおける「意味制御ノード（Semantic Control Node）」を担う**  
  AITL全体の制御構造における可変性と知的判断機能を担う中核。

- **状態遷移・推論制御・自己適応などの上位機構のプロトタイプをソフト制御で実装**  
  FSMベースの状態制御や、パラメトリックな推論モデルの運用を通じて、PoCに知的挙動を付与。

- **将来的なAI自己修復系（第8章）への接続基盤**  
  ソフト制御層は、AIによる自己診断・自己最適化機構と直接接続される領域。ここでの設計方針が、PoC→AI PoCへの進化を決定づける。


## 5.6 PoCソフト制御コードの管理方針

- **ソース構成**  
  `src/sw/` 以下に機能別ディレクトリを設け、目的別にソースを整理。  
  例：
```text
  src/sw/
├── pid_ctrl/
├── pwm_test/
└── sensor_adc/
```

- **ビルド環境**  
RISC-V向けGCCツールチェーン、またはPlatformIO環境の導入を推奨。

- **ドキュメント管理**  
各ソフト制御モジュールと対応レジスタの一覧を `docs/appendix/` 以下に整理し、PoCの再構成性を支援する。

## 5.7 本章まとめ

- **RISC-Vベースのソフト制御設計は、AITL構造とハードウェア制御を橋渡しする知的接続ノード**である。
- **制御ロジックの固定部（RTL）と可変部（ソフト）を分離**することで、柔軟かつ評価可能なPoCが実現できる。
- **次章では、アナログ信号処理とセンサ統合について、AITL構造との整合設計を扱う**。

---

# 第6章 センサ混載技術とアナログIF設計（AITL構造反映）

## 6.1 本章の目的
本章では、制御系PoCにおいて不可欠なセンサ混載とアナログインタフェース（IF）設計について、  
AITL構造との対応を意識しながら、設計指針・実装技術・評価の勘所を整理します。


## 6.2 センサ混載とPoCアーキテクチャへの影響
- センサ混載は**「物理世界→情報世界」の接点**であり、PoC精度と応答性に直接影響
- センサ出力（アナログ/デジタル）の整合性がPoC機能分離の起点
- 混載設計における重要因子：
  - ノイズ隔離、電源分離、パッケージ制限
  - センサ位置とADC精度の関係
  - 時間軸同期（タイムスタンプ）


## 6.3 アナログIF（インタフェース）設計の基礎
### 6.3.1 ADC構造と選定
- SAR型ADC（逐次比較型）：一般的な制御PoCに最適
- ΔΣ型ADC：高精度センシング用途、ノイズに強い
- フロントエンドのポイント：ゲイン設定、LPF（低域フィルタ）、同相ノイズ除去

### 6.3.2 インタフェース構成例
```text
[Sensor Signal]
↓ (Analog)
[Gain + LPF] → [ADC] → [Digital Domain (RTL)]
```

- 各ブロックは明示的にAITLノードとして定義可能（構造階層化）


## 6.4 センサのAITL構造へのマッピング
- センサは**AITL構造木の「葉ノード」に相当**
- センサ種別・特性・配置条件はAITL属性情報として明記
- 例：温度センサ（0.1°C分解能）、電流センサ（±5A範囲）、応力センサ（パッケージ応力監視）

### 6.4.1 センサ情報のAITL記述テンプレート（案）
| 属性             | 値例                            |
|------------------|---------------------------------|
| センサ名         | TMP36                           |
| 出力形式         | Analog (Voltage)                |
| 範囲・分解能     | -40°C〜125°C / 0.1°C            |
| 接続IF           | ADC Channel 2                   |
| 構造ノード名     | `sensor_tmp36_leaf`             |


## 6.5 センサ混載の実装勘所と制約
- **ESD保護・アナログGND分離**：デジタル混載時にクロストーク対策が必須
- **温度ドリフト補償**：制御ループがセンサ特性に依存する場合、温度補正モデルが必要
- **キャリブレーション**：電圧→物理量換算におけるオフセット補正、係数の初期化処理


## 6.6 アナログIFとRTL・ソフトの接続
- ADC結果は `adc_if.v` モジュール経由で RTL に引き渡し
- ソフト側でのセンサ情報処理（平均化・分類・異常検知）を組み合わせる
- センサ→ADC→RTL→RISC-V という **情報伝播の構造化** が AITLモデル化の基礎


## 6.7 本章まとめ

- センサ混載とアナログIFはPoCの物理境界層を構成し、**情報入力の質を決定づける**
- AITLでは、センサを意味構造の「葉」として管理し、属性・構造・目的の観点から統一的に記述する
- 次章では、評価・テストのための設計指針と、**DFT（Design for Test）** 設計に進む

---

# 第7章 DFT設計とテスト容易化（AITL評価指標含む）

## 7.1 本章の目的
本章では、PoC設計におけるDFT（Design for Test）手法の導入と、テスト容易化設計の実践ポイントを解説します。  
また、AITL評価構造に基づき、機能性・可観測性・再構成性といった観点からテスト可能性を捉える方法を提示します。


## 7.2 DFT（Design for Test）とは
- DFTは「製品完成後に機能・構造を検証するための設計支援手法」
- 主な目的：**製造不良の検出・診断性向上・フィールドリカバリ支援**
- PoCでは、評価・実証実験・再設計サイクル短縮の観点から必須


## 7.3 DFT技術のPoC適用例
| DFT手法            | PoCでの適用内容                         |
|--------------------|------------------------------------------|
| スキャン設計        | FSMや制御ロジックの状態可視化に活用     |
| BIST（Built-In Self Test） | ADC、PWM回路の自己診断                |
| JTAG               | デバッグインタフェースの標準化           |
| 組込みロジックアナライザ | SoC内部信号の波形観測・解析             |
| トリガ回路         | イベント検出・異常検知のきっかけ信号生成 |


## 7.4 テスト容易化の設計原則
- **可視化：観測点の設計段階での明示**  
  内部信号を外部から読み取れる構造を意図的に設計

- **可制御性：特定の状態遷移を強制できる機構の導入**  
  初期化パスやテストモード切替制御の実装

- **テストパタン準備：PoC開発段階での検証資産整備**  
  RTLシミュレーションパタン → FPGAテスト → ASIC想定環境への展開


## 7.5 AITL視点からのテスト性と評価
### 7.5.1 AITLにおけるテスト構造の分類
- L2層：構造的可視化（ノード単位の信号出力）
- L1層：機能的可視化（目的関数の実現状態）
- L0層：物理観測点（センサ・電源ラインなど）

### 7.5.2 AITL対応評価指標の例
| 指標名              | 意味                              | 計測方法                 |
|---------------------|-----------------------------------|--------------------------|
| 可観測性スコア      | 内部状態の外部出力化率             | ロジックアナライザ信号数 |
| 可制御性スコア      | 外部入力による状態遷移可能性       | テストパタン反映率       |
| 再構成性指標        | 局所故障時の動作切替柔軟性         | BIST＋構成切替記録       |


## 7.6 DFTとAITL構造の接続実践
- テスト回路・診断構造もAITLモデルの「構造ノード」として定義可能
- AITL設計テンプレートに、**"test_node"** や **"diagnostic_leaf"** を追加定義
- PoC段階での評価データ収集を通じて、**「自己評価可能な設計」** を志向する


## 7.7 本章まとめ

- DFTはPoC段階でも有効な評価設計技術であり、後工程を見据えた設計資産化を支援する
- AITL構造と整合させることで、テスト可能性や診断性を**構造的かつ形式的に表現**できる
- 次章では、**AI自己修復PoC設計**という高度な展開例を通じて、AITL理論の応用を示す

---
# 第8章 AI自己修復PoC設計手法（AITL理論適用）

## 8.1 本章の目的
本章では、PoC設計にAI要素を導入し、**自己修復機構（Self-Healing System）** を持つ知的制御PoCを構築する手法を解説します。  
AITL理論に基づき、認識・判断・構造再構成の3層アプローチで自己修復設計の具体例を示します。


## 8.2 自己修復システムとは何か
- **異常を自律的に検知・診断し、回復・再構成する機構**
- 特にPoC設計段階での意義：
  - 故障モードの観察と評価
  - ソフトウェア・ハードウェア両面の修復可否を事前検証
  - 評価モデルの学習資産化（AITL構造に統合）


## 8.3 AITL構造に基づく3層自己修復構造
### 8.3.1 L0層：物理層の異常検知
- センサ／電源ライン／温度／電圧モニタ
- 装置特性からの逸脱をリアルタイムに数値判定
- 外部環境との関係：温度ドリフト、電源変動、ノイズ源影響

### 8.3.2 L1層：機能層の目的関数評価
- PIDなどの制御系出力 vs. 目標値の偏差を継続監視
- 評価関数例：J(t) = ∫(目標値 - 出力)^2 dt（オンライン計算）
- AI判定に接続：性能劣化の定量化指標を算出

### 8.3.3 L2層：構造層の再構成制御
- 回路切替、冗長モジュール有効化、ゲイン再調整など
- 構造の「可変性」を事前設計し、AI判断によって分岐
- RISC-V上のソフトロジックによる構成制御


## 8.4 実装モデルの構成例
### 8.4.1 全体構成
```text
[Sensor] → [ADC] → [Control Logic]
↓
[AITL Evaluator] → [AI判定機構] → [構造切替制御]
```

- AITL Evaluator：目的関数と現在値の差分評価
- AI判定機構：異常判定＋修復方針決定（閾値・学習モデル）
- 構造切替制御：MUX制御、ゲイン更新、構成分岐など


## 8.5 修復ロジックの設計例（PoC）
| 修復対象           | 実装手法                             |
|--------------------|--------------------------------------|
| ゲイン逸脱         | ソフトウェアから再設定（RISC-V）     |
| ADC不良            | 予備ADCへのMUX切替                   |
| PWM故障            | 冗長PWMモジュールに切替               |
| センサ異常         | 時系列外れ値検出＋代替センサ推論     |


## 8.6 学習・推論機構のPoC適用
- シンプルなAIで十分：SVM、決定木、k-NN、ルールベースでも適用可能
- データ収集は `eval/` 以下に保存、PoC評価に活用
- 学習済みモデルは `src/sw/ai_model/` に格納（予定）


## 8.7 AITL理論と自己修復設計の整合性
- 自己修復はAITL目的関数の維持行動であり、**AITL設計原則における中核応用**
- 各修復パスは「AITL構造木」の構成切替と一致
- 評価・修復・再評価のループをAITLにより形式化可能


## 8.8 本章まとめ

- AI自己修復PoCは、AITL設計資産の中でも**知的評価・行動選択機構**の応用例である
- 構造の可変性を設計段階で盛り込むことで、実用PoCへの耐障害性評価が可能になる
- 次章では、これらの設計資産をSoC全体として統合し、協調設計の枠組みを提示する

---

# 第9章 SoC統合と協調設計（ハード＋ソフト＋AITL連携）

## 9.1 本章の目的
本章では、制御系PoCをSoCとして統合する際の**ハードウェア・ソフトウェア・AITL構造の協調設計**手法を示します。  
複数モジュール・異種構成要素が連携するシステム全体設計の要点を整理し、AITLにおける階層的連携構造とマッピング方法を解説します。


## 9.2 SoC統合設計の全体像
- SoC統合とは、**機能別PoCブロックを一つのチップにまとめる工程**
- ハード：センサIF／制御／出力／通信
- ソフト：制御則／構成切替／診断／ログ
- AITL：目的関数統合／構造木整合／評価ロジックの一元化

### 9.2.1 構成例
    +---------------------------+
    |      SoC Top (AITL統合)    |
    |                           |
    |  +---------------------+  |
    |  |   Sensor IF Block   |  |
    |  +---------------------+  |
    |  |   Control RTL Core  |  |
    |  +---------------------+  |
    |  |   RISC-V CPU + SW   |  |
    |  +---------------------+  |
    |  |   PWM / Output Ctrl |  |
    |  +---------------------+  |
    +---------------------------+


## 9.3 ハードウェア統合設計の勘所
- **I/F設計：IP間のバス接続（AXI/APB/SPI）と制御信号整合**
- **レイアウト制約：センサ近接配置、ESD構造、電源分離**
- **電源・リセット設計：SoC全体の状態一貫性保持**
- **クロックドメイン分離と同期手法：CDC設計方針の明示**


## 9.4 ソフトウェア構造の統合ポイント
- **マルチタスク管理：センサ処理／制御出力／診断を並列処理**
- **設定項目の構造化：構成情報をJSON等で記述し、PoC切替に対応**
- **デバッグログ統合：UART/I2C経由で各層状態を出力、再構成に活用**
- **AITL視点の構成制御：Semantic Nodeをソフト上に展開し、各層の関数対応を記述**


## 9.5 AITL構造のSoC統合対応
### 9.5.1 階層統合のマッピング
| AITL層     | 対応対象                     |
|------------|------------------------------|
| L0         | センサ・電源・物理構造       |
| L1         | 制御モジュール・評価ロジック |
| L2         | システム構造・構成選択制御   |

### 9.5.2 統合評価関数の設計
- 各サブモジュールの目的関数を統合した**システム目的関数**を定義
- AITL Evaluatorで階層的に重み付け、状態追跡可能な構造とする


## 9.6 協調設計プロセスとPoC推進体制
- **開発分担例**：
  - ハード：制御コア、PWM、センサIF
  - ソフト：RISC-Vコード、診断アルゴリズム、構成ファイル
  - AITL設計：目的関数、構造記述、評価関数生成

- **ドキュメント整備**：
  - `docs/architecture/`：AITL設計構造
  - `docs/interfaces/`：モジュール間I/F仕様
  - `docs/config/`：構成選択と制御方法


## 9.7 本章まとめ

- SoC統合には、構造・機能・制御・評価の各要素を**多層で整合させる協調設計**が求められる。
- AITLの階層構造を用いることで、**モジュール統合と評価統合**を両立できる設計管理が可能になる。
- 次章では、PoC設計の進行管理と評価プロセスを具体化し、プロジェクト全体の進行モデルを提示する。

---

# 第10章 PoCプロジェクトの管理と評価（AITL評価体系・ドキュメント管理）

## 10.1 本章の目的
本章では、PoC開発プロジェクトを効率的に進行・管理するための手法と、AITLに基づく評価体系の構築・運用方法を解説します。  
設計成果物・評価データ・ドキュメントの体系的整理によって、**PoC→SystemDKへの資産移行**を支える基盤を構築します。


## 10.2 PoC開発の進行管理モデル
- **ステージゲート型開発**：PoCの段階的検証と設計マイルストンの明確化
- **フィードバック重視**：実装→評価→修正→再評価のループを高速化
- **AITLとの整合**：評価関数・構造ノード・目的関数に対応したレビュー設計

### 10.2.1 推奨プロセスフロー
```text
[仕様策定] → [構造設計] → [実装] → [AITL評価] → [修正] → [成果記録]
```

## 10.3 評価体系の設計（AITLベース）
### 10.3.1 評価軸の分類
| 軸            | 概要                         | 関連AITL層 |
|---------------|------------------------------|-------------|
| 機能性         | 仕様どおり動作しているか       | L1          |
| 安定性         | 外乱や変動に対する耐性         | L1/L2       |
| 再構成性       | 故障・劣化時の構成切替性能     | L2          |
| 評価可能性     | 評価データの収集・分析容易性   | L0〜L2      |

### 10.3.2 評価関数例
- \( J_{\text{func}} = \sum_{t=0}^{T} (y_{\text{target}}(t) - y(t))^2 \)
- \( J_{\text{reconf}} = \frac{\text{回復時間}}{\text{性能低下量}} \)
- \( J_{\text{visibility}} = \frac{\text{観測可能な内部ノード数}}{\text{全ノード数}} \)


## 10.4 ドキュメント管理と資産化
### 10.4.1 フォルダ構成例
```text
docs/
├── specs/         # 要件定義書・仕様書
├── architecture/  # AITL構造記述
├── eval/          # 評価データと評価結果
├── appendix/      # テンプレート・変換表
```

### 10.4.2 記録の観点
- 各フェーズごとの**入力・出力・評価指標**を明記
- GitHub連携での**バージョン管理と差分追跡**
- AITLノードごとの**評価結果・設計履歴**の紐付け


## 10.5 チーム運営とレビュー制度
- **役割分担**：設計／実装／評価／AITL管理 各担当明確化
- **週次レビュー**：AITL階層ごとの進捗と課題抽出
- **PoC成果レビュー**：第0章→第16章までの進行と整合性を照合


## 10.6 AITL設計資産の移行管理
- PoC段階で得られたAITL構造は、SystemDKに向けての**設計メタ情報**となる
- 設計データと評価データの対応関係を明示的に保存し、**設計意図の継承性**を確保


## 10.7 本章まとめ

- PoC開発は「仕様」→「構造」→「実装」→「評価」→「資産化」という**循環型プロジェクト**である
- AITL評価体系を活用することで、**目的関数に基づいた設計管理とレビュー制度**を実現できる
- 次章では、SystemDKとの構造整合を意識した**出口設計と移行戦略**を扱う

---

# 第11章 出口戦略とSystemDK移行設計（AITL→SystemDK変換）

## 11.1 本章の目的
本章では、PoCで得られた設計成果とAITL構造を、製品化を見据えたSystemDKへ移行するための**出口戦略と設計変換方針**を解説します。  
設計情報・構造・評価指標をSystemDK対応形式に再構築することで、PoCの知的価値を最大化します。


## 11.2 出口戦略とは何か
- 「PoCでの設計成果を、次段階の製品・IP開発にどう接続するか」の方針
- 一般に、以下の3方向がある：
  - **製品化（ASIC/SoC）**
  - **評価ボード展開（FPGAベース）**
  - **設計資産化（SystemDK再利用）**


## 11.3 SystemDKとの整合設計とは
### 11.3.1 SystemDKの位置づけ
- 再構成可能・再利用可能なIP設計思想
- ハード＋ソフト＋知的構造（AITL）を包括的に表現

### 11.3.2 AITL→SystemDKの変換観点
| AITL概念         | SystemDK対応形式                |
|------------------|---------------------------------|
| 構造ノード        | 機能ブロック（Block）            |
| 意味制御ノード    | 制御構造（FSM、OSタスク）       |
| 評価関数          | 評価ロジック／メトリクス定義     |
| 再構成制御        | コンフィグ機構・MUX・パラメータ  |


## 11.4 PoCからSystemDKへの設計情報マッピング
### 11.4.1 構造変換テンプレート（例）

| PoC構成要素       | SystemDK変換形式               | 備考                        |
|------------------|-------------------------------|-----------------------------|
| PID制御RTL       | `ctrl_pid.v` → Block化         | 外部IF定義＋パラメータ設計 |
| RISC-Vソフト制御  | `main.c` → Task形式に分離      | OSタスク設計準備            |
| AITL構造記述     | JSON/YAML化して付与            | SystemDK解析基盤へ渡す     |


## 11.5 評価・検証結果の引き継ぎ
- `eval/` 以下のログや評価関数結果を**SystemDKテストベンチ構成に反映**
- パターン自動生成・再評価ツールへの接続も検討
- SystemDK上での**自己評価型IP化**が将来的出口


## 11.6 ドキュメントと設計資産の再構成
### 11.6.1 設計ドキュメントの変換方針
| PoCドキュメント   | SystemDK用再構成              |
|------------------|-------------------------------|
| `docs/specs/`    | IPブロック仕様書に再構成       |
| `docs/architecture/` | SystemDK構造記述（XML/YAML）  |
| `docs/eval/`     | テストベンチ構成＋比較表形式    |

### 11.6.2 設計テンプレート整備
- `templates/` ディレクトリにSystemDK用テンプレート追加（Verilogヘッダ、ソフト定義、AITL YAML）


## 11.7 出口戦略選定のためのチェック観点
- PoC評価の再現性（SystemDKへ変換後も成立するか）
- 再構成性と再利用性の明示化
- 量産設計への適用可能性（エリア／消費電力／検証性）


## 11.8 本章まとめ

- PoC段階で得たAITL構造・評価資産を、SystemDKという形式知へと移行することで**設計の持続性と発展性**が担保される
- 出口設計は、**目的達成と知的資産化の両立**を図る重要工程であり、PoC計画段階からの逆算設計が望ましい
- 次章では、SystemDKへの展開に向けた実装・検証の具体的技術課題に取り組む

---

# 第12章 PoC評価の指標とプロジェクト管理（AITL観点の評価指標）

## 12.1 本章の目的
本章では、PoCプロジェクト全体の**評価指標体系とマネジメント構造**を定義します。  
AITL設計に基づく目的関数ベースの指標を採用し、PoC段階での評価を「意味ある成果」に昇華させるための仕組みを提示します。


## 12.2 AITLに基づく評価観点
### 12.2.1 3階層評価モデル

| 評価層 | 評価対象                       | 主な目的関数例                     |
|--------|--------------------------------|------------------------------------|
| L0     | 物理層（センサ・電源・IO）     | 動作安定性、物理信頼性            |
| L1     | 機能層（制御・信号処理）       | 制御精度、応答速度、ロバスト性    |
| L2     | 構造層（再構成性・適応性）     | 自己修復性、構成切替の柔軟性      |


## 12.3 評価指標の具体化と算出方法

### 12.3.1 評価指標例

| 指標名            | 説明                                  | 単位           |
|-------------------|---------------------------------------|----------------|
| 制御誤差積分      | 目標値との偏差の2乗積分                | \[J\]           |
| 再構成応答時間    | 異常後の復旧までに要した時間           | \[ms\]          |
| 可観測ノード率    | 全ノードのうち外部観測可能な割合       | [%]            |
| 消費電力           | 動作時の総電力消費                    | [mW]           |
| モジュール再利用率| SystemDKに移行可能な資産の割合         | [%]            |

### 12.3.2 評価の自動化

- `eval/` 配下にログ出力形式を統一（CSV, JSON）
- AITL構造IDと紐付けてデータを記録
- 評価ツールスクリプトは `tools/eval/` に整備（予定）


## 12.4 プロジェクト進行の評価モデル

### 12.4.1 マイルストーン例

| フェーズ             | 成果物                         | 評価観点                     |
|----------------------|-------------------------------|------------------------------|
| PoC構造定義         | AITL構造記述（YAML）           | 記述網羅性、階層整合性       |
| 実装完了             | RTL / ソフトコード              | 動作確認、構成整合           |
| 評価ログ取得         | `eval/` に測定ログ出力         | 評価指標算出、再構成確認     |
| 出口設計             | SystemDK設計資産                | モジュール化率、再利用性     |


## 12.5 評価レポートの標準構成
```text
	•	評価対象ブロック名：
	•	評価実施日：
	•	評価条件（温度・電源・クロック）：
	•	評価指標一覧：
	•	制御誤差積分：23.1
	•	再構成応答時間：5.2ms
	•	可観測ノード率：87.5%
	•	考察：
・目的関数達成のための修正ポイントは……
```

## 12.6 成果管理とSystemDK移行支援
- `docs/eval/summary.md`：評価結果の集約・可視化
- `docs/appendix/`：指標定義集、変換ルール記録
- SystemDK移行時は評価データをマッピング補助情報として活用


## 12.7 本章まとめ

- AITLを基盤に据えることで、PoC評価が**構造的・目的関数的な意味を持つ**
- 評価結果は、プロジェクトの成果の可視化・再利用・製品化判断に直結する
- 次章では、製品化に向けた物理・実装面での検証課題を扱う

---

